\hypertarget{demo_pid_load_from_file_8cpp-example}{}\section{demo\+\_\+pid\+\_\+load\+\_\+from\+\_\+file.\+cpp}
Load the P\+ID gains from a yaml file and create a P\+ID controller from them.\+This illustrates how to safely use the A\+PI when yaml file parsing is wanted.


\begin{DoxyCodeInclude}

\textcolor{preprocessor}{#include "\hyperlink{pid_8hpp}{ci\_example\_cpp/pid.hpp}"}
\textcolor{preprocessor}{#include "\hyperlink{file__configuration_8hpp}{ci\_example\_cpp/file\_configuration.hpp}"} 
\textcolor{preprocessor}{#include <stdexcept>}

\textcolor{keywordtype}{void} \hyperlink{demo__pid__load__from__file_8cpp_aa5343637e5c7a19c19aae1beed976ab6}{run\_demo}()\{

  \textcolor{comment}{/* displaying what this demo is about */}
  std::cout << 
    \textcolor{stringliteral}{"This demo shows how to create an executable run by the continuous integration\(\backslash\)n"} <<
    \textcolor{stringliteral}{"which depends on a configuration file. In the solution showed here, the absolute path\(\backslash\)n"} <<
    \textcolor{stringliteral}{"to the configuration file is set during pre-compilation. See code in
       /demos/demo\_pid\_load\_from\_file.cpp\(\backslash\)n"} <<
    \textcolor{stringliteral}{"for details\(\backslash\)n\(\backslash\)n"};
  
  \textcolor{comment}{/* reading gains (kp,kd,ki) from yaml config */}

  \textcolor{comment}{// (look at the CMakeLists.txt to see why TEST\_PID\_GAINS\_YAML\_FILE\_PATH is replaced by correct abs path 
       during compilation)}
  std::string config\_file\_path = TEST\_PID\_GAINS\_YAML\_FILE\_PATH;

  \textcolor{comment}{// Gains\_configuration is the base class for all configuration, including}
  \textcolor{comment}{// the one read from yaml file, as done here. }
  \hyperlink{classci__example__cpp_1_1File__configuration}{ci\_example\_cpp::File\_configuration} gains = 
      \hyperlink{classci__example__cpp_1_1File__configuration}{ci\_example\_cpp::File\_configuration}(config\_file\_path);

  \textcolor{comment}{// printing to standard output the gains}
  std::cout << \textcolor{stringliteral}{"gains read from configuration file:"} << std::endl;
  \hyperlink{gains__configuration_8hpp_a2400ff05e31dee6aced75d9c230b9fe5}{ci\_example\_cpp::print\_configuration}(gains);

  \textcolor{comment}{// checking reading the config file when fine}
  \textcolor{comment}{// if not, throwing corresponding error}
  \textcolor{keywordflow}{if} (gains.\hyperlink{classci__example__cpp_1_1File__configuration_aa3cae137be3b59e61d13c2a9b1ec8b6a}{has\_error}())\{
    \textcolor{keywordflow}{throw} std::runtime\_error(gains.\hyperlink{classci__example__cpp_1_1File__configuration_aaf67f7d61d467563a4dce8aa69306a6a}{get\_error}());
  \}

  \textcolor{comment}{/* creating and running the controller */}

  \textcolor{comment}{// PID controller creation}
  \hyperlink{classci__example__cpp_1_1PID}{ci\_example\_cpp::PID} controller(gains);
  
  \textcolor{comment}{// example of force computation}
  \textcolor{keywordtype}{double} current\_position=1;
  \textcolor{keywordtype}{double} current\_velocity=1;
  \textcolor{keywordtype}{double} delta\_time=0.01;
  \textcolor{keywordtype}{double} target\_position=2;
  \textcolor{keywordtype}{double} force = controller.compute(current\_position,current\_velocity,target\_position,delta\_time);
  std::cout<< \textcolor{stringliteral}{"computed force: "} << force << std::endl;

  \textcolor{comment}{// resetting integral of the controller}
  controller.reset\_integral();
  
\}

\textcolor{keywordtype}{int} \hyperlink{demo__pid__load__from__file_8cpp_ae66f6b31b5ad750f1fe042a706a4e3d4}{main}()\{
  
  \textcolor{keywordflow}{try} \{
    \hyperlink{demo__pid__load__from__file_8cpp_aa5343637e5c7a19c19aae1beed976ab6}{run\_demo}();
  \} \textcolor{keywordflow}{catch}(\textcolor{keyword}{const} std::runtime\_error& e)\{
    std::cout << \textcolor{stringliteral}{"demo failed !\(\backslash\)nerror message:\(\backslash\)n"} << e.what() << std::endl;
    \textcolor{keywordflow}{return} 1; \textcolor{comment}{// informs continuous integration that this demo did not run successfully}
  \}

  \textcolor{keywordflow}{return} 0; \textcolor{comment}{// informs continuous integration that this demo did run successfully}

\}
\end{DoxyCodeInclude}
 